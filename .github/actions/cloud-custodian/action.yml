name: Run Cloud Custodian
description: Run Cloud Custodian

inputs:
  configPath:
    description: 'Path to the Cloud Custodian policy file'
    required: true

  preview:
    description: 'Run Cloud Custodian in preview mode'
    required: false
    default: false

runs:
  using: composite
  steps:

    - name: Run Cloud Custodian
      shell: bash
      run: |
        docker run -i \
          -v ${{ inputs.configPath }}:/home/custodian/policy.yml \
          --env-file <(env | grep "^AWS\|^AZURE\|^GOOGLE") \
            cloudcustodian/c7n:dev run -v -s . --dryrun /home/custodian/policy.yml
